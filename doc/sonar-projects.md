# sonar-projects (export/import)

Exports (or imports) projects of a given Server instance to / from zip files (This is NOT possible with SonarQube Cloud)

- When exporting, the tool generates a JSON with the list of project keys, the export result (`SUCCESS` or `FAIL`), and:
  - If the export was successful, the generated zip file
  - If the export was failed, the failure reason

- When importing, a JSON file (result of export) must be provided

`sonar-projects` replaces the deprecated `sonar-projects-export` and `sonar-projects-import` commands

Basic Usage:
`sonar-projects -e [--exportTimeout <timeout>] [--skipZeroLoC] -f exported_projects.json`
- `--exportTimeout`: Defines timeout to export a single project in seconds,
                     by default 180 s (large projects can take time to export)
- `--skipZeroLoc`    Skips export of projects with zero lines of code
- `-f`: Defines the file for JSON output (default stdout)

`sonar-projects -i [--importTimeout <timeout>] -f exported_projects.json`
- `--importTimeout`: Defines timeout to import a single project in seconds,
                     by default 180 s (large projects can take time to import)
- `--skipZeroLoc`    Skips import of projects with zero lines of code (if they were exported in the first place)
- `-h`, `-u`, `-t`, `-o`, `-v`, `-l`, `--httpTimeout`, `--threads`, `--clientCert`: See **sonar-tools** [common parameters](https://github.com/okorach/sonar-tools/blob/master/README.md)

:information_source: All zip files are generated in the SonarQube Server instance standard location (under `data/governance/project_dumps/export`). On a DCE, the export may be distributed over all the Application Nodes
:warning: **sonar-tools** 2.7 or higher is required for compatibility with SonarQube Server 10

To import, the zip file smust be first copied under (under `data/governance/project_dumps/import`) of the target platform

## Required Permissions

`sonar-projects -e` requires `Administer project` permission on all projects to be exported
`sonar-projects -i` requires `Administer project` and `Project  creation` permission

`sonar-loc` needs `Browse` permission on all projects of the Server or Cloud instance

## Requirements and Installation

`sonar-projects` is installed through the **sonar-tools** [general installation](../README.md#install)

## Common command line parameters

`sonar-projects` accepts all the **sonar-tools** [common parameters](https://github.com/okorach/sonar-tools/blob/master/README.md)

## Examples
```
export SONAR_HOST_URL=https://sonar.acme-corp.com
export SONAR_TOKEN=squ_83356c9b2db891d45da2a119a29cdc4d03fe654e
# Exports all projects, with results of export in CSV file exported_projects.json
sonar-projects -e >exported_projects.json
# Exports 2 projects with keys myProjectKey1 and myOtherProjectKey, with results of export in JSON file exports.json
sonar-projects -e -k myProjectKey1,myOtherProjectKey -f exports.json
# Exports all projects, with results of export in JSON file exported_projects.json
sonar-projects-export -f exported_projects.json

# Import all projects with the JSON information file generated by `sonar-projects-export`
sonar-projects-import -f exported_projects.json
```

# <a name="sonar-config"></a>sonar-config

Exports or imports all or part of a SonarQube Server or Cloud platform configuration.
`sonar-config` is expected to export/import everything that is configurable in a SonarQube Server or Cloud platform, except secrets

Basic Usage: `sonar-config --export -f <file.json>`
- `-f`: Define the output file, if not specified `stdout` is used
- `-e` or `--export`: Specify the export operation
- `-w` or `--what`: Specify what to export (everything by default)
- `-k "<key1>,<key2>,...,<keyn>"`: Will only import/export projects, apps or portfolios with matching keys
- `--fullExport`: Will also export object properties that are not used for an import by may be of interest anyway
See [sonar-config complete doc](https://github.com/okorach/sonar-tools/blob/master/doc/sonar-config.md)

:warning: **sonar-tools** 2.7 or higher is required for compatibility with SonarQube Server 10

## Required Permissions

To export and import configuration, `sonar-config` needs elevated permissions.
See [sonar-config complete documentation](https://github.com/okorach/sonar-tools/blob/master/doc/sonar-config.md) for details

# <a name="sonar-rules"></a>sonar-rules

Exports rules from a SonarQube Server or Cloud platform configuration.

Basic Usage: `sonar-rules -e -f <file>`
- `-f`: Define the output file, if not specified `stdout` is used
- `-e` or `--export`: Specify the export operation
- `-l` or `--languages`: Export only rules of given languages (comma separated, defined by they Sonar key, not its name)
- `--qualityProfiles`: Export rules defined in a given quality profile. In this case the `--languages` option is mandatory and should specify a single language
- `-h`: Display help with the full list of options

## Required Permissions

`sonar-rules` needs simple browse permissions

## Examples
```
export SONAR_HOST_URL=https://sonar.acme-corp.com
export SONAR_TOKEN=squ_83356c9b2db891d45da2a119a29cdc4d03fe654e

# Exports all rules from https://sonar.acme-corp.com, in CSV or in JSON
sonar-rules -f rules.csv
sonar-rules -f rules.json
# Exports rules for languages Java, C# and C++
sonar-rules -l "java, cs, cpp" -f rules.csv
# Exports rules of quality profile "Sonar way" of language Java 
sonar-rules -l java --qualityProfile "Sonar way" >rules.csv
```

# <a name="docker"></a>Using sonar-tools in Docker

Starting from version 3.4 `sonar-tools` is available as a docker image. Here is how to use the docker version:
```
docker pull olivierkorach/sonar-tools:latest
# Run `docker run --rm olivierkorach/sonar-tools` followed by your usual sonar-tools command with its parameters, and example below for sonar-loc
docker run --rm olivierkorach/sonar-tools sonar-loc -u <YOUR_SONAR_URL> -t <YOUR_SONAR_TOKEN> <parameters>

# Alternatively you can pass the Sonar(Qube/Cloud) URL and token as environment variables
docker run --rm -e SONAR_TOKEN=<YOUR_SONAR_TOKEN> -e SONAR_HOST_URL=<YOUR_SONAR_URL> olivierkorach/sonar-tools sonar-loc <parameters>

# Trick if your SonarQube Server is on http://localhost, the URL to pass to docker is http://host.docker.internal, for instance:
docker run --rm -e SONAR_TOKEN=$SONAR_TOKEN -e SONAR_HOST_URL=http://host.docker.internal:9000  olivierkorach/sonar-tools

# The docker image contains all the sonar-tools. Here are other invocation examples
docker run --rm -e SONAR_TOKEN=$SONAR_TOKEN -e SONAR_HOST_URL=https://sonar.acme.com olivierkorach/sonar-tools sonar-measures-export -k <projectKey> -m _all
docker run --rm -e SONAR_TOKEN=$SONAR_TOKEN -e SONAR_HOST_URL=https://sonar.acme.com olivierkorach/sonar-tools sonar-findings-export -h
docker run --rm -e SONAR_TOKEN=$SONAR_TOKEN -e SONAR_HOST_URL=https://sonar.acme.com olivierkorach/sonar-tools sonar-housekeeper -P 90 --mode dry-run --threads 4
docker run --rm -e SONAR_TOKEN=$SONAR_TOKEN -e SONAR_HOST_URL=https://sonar.acme.com olivierkorach/sonar-tools sonar-projects-export
docker run --rm -e SONAR_TOKEN=$SONAR_TOKEN -e SONAR_HOST_URL=https://sonar.acme.com olivierkorach/sonar-tools sonar-config -e --what projects
```

Be aware that by default, files generated in the container are not available from the host. For files generated by sonar-tools you can either use stdout or volumes
```
# The below works, the file config.json is generated on the host
docker run --rm -e SONAR_TOKEN=$SONAR_TOKEN -e SONAR_HOST_URL=https://sonar.acme.com olivierkorach/sonar-tools sonar-config -e > config.json

# The below doesn't work, the file config.json is generated in the container and, by default, not accessible from the host
docker run --rm -e SONAR_TOKEN=$SONAR_TOKEN -e SONAR_HOST_URL=https://sonar.acme.com olivierkorach/sonar-tools sonar-config -e -f config.json

# If you want the 2nd form above to work you must use volumes, for instance:
docker run --rm -w `pwd` -v `pwd`:`pwd` -e SONAR_TOKEN=$SONAR_TOKEN -e SONAR_HOST_URL=https://sonar.acme.com olivierkorach/sonar-tools sonar-config -e -f config.json
# After the command the file config.json should be in the local (pwd) directory
```

# <a name="exit-codes"></a>Exit codes

When tools complete successfully they return exit code 0. En case of fatal error the following exit codes may be returned:
- Code 1: Authentication error (Incorrect token provided)
- Code 2: Authorization error (provided token has insufficient permissions)
- Code 3: Other general Sonar API HTTP error
- Code 4: No token provided
- Code 5: Non existing project key provided
- Code 6: Incorrect finding search criteria provided
- Code 7: Unsupported operation requested (because of SonarQube Server edition or configuration)
- Code 8: Audit rule loading failed (at startup)
- Code 9: SIF audit error (file not found, can't open file, not a legit JSON file, ...)
- Code 10: Incorrect command line arguments
- Code 11: Global analysis or project analysis token provided (user token needed for sonar-tools)
- Code 12: HTTP request time-out using the SonarQube API
- Code 13: Some operation attempted to create a Sonar object that already exists
- Code 14: Sonar connection error
- Code 15: Miscellaneous OS errors
- Code 16: Object not found during a search
- Code 17: Sonar Server internal error

# License

Copyright (C) 2019-2025 Olivier Korach
mailto:olivier.korach AT gmail DOT com

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 3 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License
along with this program; if not, write to the Free Software Foundation,
Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
